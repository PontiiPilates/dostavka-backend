# Калькулятор доставки грузов

## API-документация

[Postman](https://sergeyleshukov.postman.co/workspace/Dostavka~00637a81-c943-43c5-a285-7a02b5b8761a/request/43810662-a31699fa-cb58-4a18-813d-8583a39cbe0d?action=share&creator=43810662&ctx=documentation&active-environment=43810662-daee1545-f5e8-485f-981b-63e07f3321ce)


## Развёртывание базы данных

База данных собирается на основе методов API различных транспортных компаний. Некоторые из них требуют передавать в запросе собственные идентификаторы городов и предоставляют методы, по которым их можно получить. Отправной точкой является импорт общедоступной таблицы стран `countries.sql`. После того, как таблица появилась в базе данных, можно приступить к выполнению команд, которые на основе упомянутой таблицы и API-методов транспортных компаний, сформируют таблицу `cities`.

```shell
# формирует базовую таблицу на основе api dpd
php artisan app:fill-cities

# дополняет таблицу идентификаторами api boxberry
php artisan app:fill-boxberry
```

## Особенности работы приложения

### Организация хранения пунктов доставки

Практически каждая транспортная компания имеет собственные идентификаторы пунктов доставки. Кто-то работает с терминалами, как с конечными гео-точками, а кто-то - с городами. В зависимости от этого наименования таблиц в базе данных имеют следующую структуру `tk_company_type`, где `tk` означает, что таблица принадлежит конкретной компании `company` - название самой компании, например `dpd` и `type` означает тип пунктов, с которыми взаимодействует компания (`terminals` или `cities`). Таким образом, на данный момент существуют следующие таблицы:

`tk_kit_cities`

### Организация хранения тарифов

В зависимости от объёма тарифных платнов, хранения организовано либо в базе данных либо в типах:

- Почта России содержит множество тарифов с различными комбинациями параметров - их хранение организовано в таблице `tariffs_pochat`.
- Деловые линии использует 4 тарифа, которые являются строками для параметра запроса - их хранение организовано в Enum `DellinTariffType`.
- ЖелДорЭкспедиция использует 6 тарифов, которые являются строками для параметра запроса - их хранение организовано в Enum `JdeTariffType`.
- ПЭК использует 5 тарифных планов, которые являются целыми числами для параметра запроса - их хранение организовано в Enum `PekTariffType`.


### Варианты доставки

Приложение пытается получить все возможные способы доставки от всех компаний, по всем тарифам. При попытке сформировать запрос до API выполнение проходит через ряд ограничений о которых стало известно из документации или опытным путём. Так происходит сокращение запросов и увеличение итоговой скорости получения всех ответов. Однако не все варианты можно отфильтровать ограничениями, некоторые ответы могут возвращать неожиданные результаты. Далее вступают в работу построители итогового ответа. Из общей массы ответов от API они выбирают лишь те, что были успешно обработаны, попросту игнорируя те, что обработать не удалось.

*TODO: Добавить структуру данных, сборка которой описана выше, после того, как она будет полностью утверждена*