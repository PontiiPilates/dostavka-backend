API
==============================================

[Главная страница](/README.md) > API

## Содержание

* **[Автокомплит (в разработке)](#автокомплит)**
  * Описание процесса
  * Пример запроса
  * Пример ответа
  * Описание параметров запроса
  * Описание параметров ответа
* **[Расчёт стоимости и сроков доставки (калькуляция)](#расчёт-стоимости-и-сроков-доставки)**
  * Описание процесса
  * Пример запроса
  * Пример ответа
  * Описание параметров запроса
  * Описание параметров ответа
* **[Получение результата калькуляции](#получение-результата-калькуляции)**
  * Описание процесса
  * Пример запроса
  * Пример ответа
  * Описание параметров запроса
  * Описание параметров ответа

## Автокомплит

GET: https://example.com/api/v1/autocomplete

#### Описание процесса

Метод принимает вхождение строки и возвращает массив подходящих вариантов. Ключи этого массива являются идентификаторами для параметров `from` и `to` в методе [расчёта стоимости и сроков доставки](#расчёт-стоимости-и-сроков-доставки). Значения этого массива предназначены для отображения пользователю.

#### Пример запроса

> [Пример запроса](https://dostavka-backend.local/api/v1/autocomplete?name=мин)

```javascript
{
    "name": "мин"
}
```

#### Пример ответа

```javascript
{
    "success": true,
    "message": "",
    "data": {
        "22": "Минск (город), Республика Беларусь, Беларусь",
        "250": "Минусинск (город), Красноярский край, Россия",
        "895": "Минеральные Воды (город), Ставропольский край, Россия",
        "896": "Миньяр (город), Челябинская область, Россия",
        "2866": "Минеральные Воды (город), Зольский район, Ставропольский край, Россия"
    }
}
```

#### Описание параметров запроса

| Имя параметра | Тип    | Обязательный | Описание                                       |
| ------------- | ------ | ------------ | ---------------------------------------------- |
| `name`        | string | Да           | Вхождение для получения подходящих результатов |

#### Описание параметров ответа

| Имя параметра | Тип   | Описание                     |
| ------------- | ----- | ---------------------------- |
| `data`        | array | Массив релевантных вариантов |

## Расчёт стоимости и сроков доставки

GET: https://example.com/api/v1/calculate

#### Описание процесса

Метод принимает параметры для расчёта сроков и стоимости доставки, а возвращает идентификатор для получения результатов этого расчёта. Дело в том, что скорость расчётов у одной транспортной компании занимает менее 1 секунды, а у другой - более 10 секунд. Поэтому запросы выполняются независимо, а результаты их выполнения записываются в Redis. Доступ к этой записи можно получить по идентификатору, который возвращает данный метод.

#### Пример запроса

> [Пример запроса](https://dostavka-backend.local/api/v1/calculate?from=212&to=256&places[0][weight]=20&places[0][length]=100&places[0][width]=50&places[0][height]=20&places[1][weight]=10&places[1][length]=75&places[1][width]=15&places[1][height]=10&companies[]=pek&companies[]=vozovoz&delivery_type[]=ss&delivery_type[]=dd&insurance=3200&shipment_date=2025-10-10)

```javascript
{
    "from": 212,
    "to": 256,
    "places": [
        {
            "weight": "20",
            "length": "100",
            "width": "50",
            "height": "20",
        },
        {
            "weight": "10",
            "length": "75",
            "width": "15",
            "height": "10",
        }
    ],
    "companies": [
        "pek",
        "vozovoz"
    ],
    "delivery_type": [
        "ss",
        "dd"
    ],
    "insurance": 3200,
    "shipment_date": "2025-09-06"
}
```

#### Пример ответа

```javascript
{
    "success": true,
    "message": "",
    "data": {
        "transaction": "e26fa965bcc89068c5dac7cf233dd2fc"
    }
}
```

#### Описание параметров запроса

| Имя параметра      | Тип   | Обязательный | Описание                                        | Будет изменён                                                                               |
| ------------------ | ----- | ------------ | ----------------------------------------------- | ------------------------------------------------------------------------------------------- |
| `from`             | int   | Да           | Откуда (ключ)                                   | После написания метода autocomplete будут внесены коррективы в формат принимаемого значения |
| `to`               | int   | Да           | Куда (ключ)                                     | После написания метода autocomplete будут внесены коррективы в формат принимаемого значения |
| `places`           | array | Да           | Грузовые места. Коллекция грузовых мест.        | -                                                                                           |
| `weight`           | float | Да           | Вес грузового места, кг                         | -                                                                                           |
| `length`           | int   | Да           | Длина грузового места, см                       | -                                                                                           |
| `width`            | int   | Да           | Ширина грузового места, см                      | -                                                                                           |
| `height`           | int   | Да           | Высота грузового места, см                      | -                                                                                           |
| `companies`        | array | Да           | Компании, участвующие в расчёте                 | -                                                                                           |
| `delivery_type`    | array | Нет          | Способ доставки. Проинимает следующие значения: | -                                                                                           |
|                    |       |              | - `ss` - склад-склад;                           | -                                                                                           |
|                    |       |              | - `ds` - дверь-склад;                           | -                                                                                           |
|                    |       |              | - `sd` - склад-дверь;                           | -                                                                                           |
|                    |       |              | - `dd` - дверь-дверь                            | -                                                                                           |
| `insurance`        | int   | Нет          | Объявленная ценность, руб                       | -                                                                                           |
| `cash_on_delivery` | int   | Нет          | Наложенный платёж, руб                          | Возможно излишен                                                                            |

#### Описание параметров ответа

| Имя параметра | Тип    | Описание                                                       |
| ------------- | ------ | -------------------------------------------------------------- |
| `transaction` | string | Идентификатор транзакции для получения результатов калькуляции |

## Получение результата калькуляции

GET: https://example.com/api/v1/calculate-result

#### Описание процесса

Метод принимает идентификатор транзакции и возвращает результаты расчётов. Данные пополняются до тех пор, пока все транспортные компании, участвующие в расчёте не завершат свою работу. Количество заявленных транспортных компаний указано в параметре `count`. Фактическое количество транспортных компаний, которые завершили свою работу находится в параметре `result`. Данные снабжены флагом `is_complete`, который указывает на завершенность расчётов, он становится true, когда расчёты выполнены.

#### Пример запроса

> [Пример запроса](https://dostavka-backend.local/redis?get=e26fa965bcc89068c5dac7cf233dd2fc)

```javascript
{
    "get": "e26fa965bcc89068c5dac7cf233dd2fc"
}
```

#### Пример ответа

```javascript
{
    "count": 2,
    "request": {
        "from": "212",
        "to": "256",
        "places": [
            {
                "weight": "20",
                "length": "100",
                "width": "50",
                "height": "20"
            },
            {
                "weight": "10",
                "length": "75",
                "width": "15",
                "height": "10"
            }
        ],
        "companies": [
            "pek",
            "vozovoz"
        ],
        "delivery_type": [
            "ss",
            "dd"
        ],
        "insurance": "3200",
        "shipment_date": "2025-10-10"
    },
    "results": {
        "pek": {
            "ss": [
                {
                    "tariff": "Express Авиаперевозка",
                    "cost": 6747.23,
                    "days": {
                        "from": null,
                        "to": null
                    }
                },
                {
                    "tariff": "LTL Автоперевозка (сборный груз)",
                    "cost": 1185.02,
                    "days": {
                        "from": null,
                        "to": null
                    }
                },
                {
                    "tariff": "EasyWay Автоперевозка (Доставка для интернет магазинов)",
                    "cost": 1185.02,
                    "days": {
                        "from": null,
                        "to": null
                    }
                }
            ]
        },
        "vozovoz": {
            "ss": [
                {
                    "tariff": null,
                    "cost": 1140,
                    "days": {
                        "from": 8,
                        "to": 11
                    }
                }
            ],
            "dd": [
                {
                    "tariff": null,
                    "cost": 2950,
                    "days": {
                        "from": 8,
                        "to": 11
                    }
                }
            ]
        }
    },
    "begin": "2025-08-18T02:46:26.000802Z",
    "complete": "2025-08-18T02:46:28.512930Z",
    "is_complete": true
}
```

#### Описание параметров запроса

| Имя параметра | Тип    | Обязательный | Описание                                        |
| ------------- | ------ | ------------ | ----------------------------------------------- |
| `get`         | string | Да           | Идентификатор получения результатов калькуляции |

## Описание параметров ответа

| Имя параметра | Тип    | Описание                                                                                                              |
| ------------- | ------ | --------------------------------------------------------------------------------------------------------------------- |
| `count`       | int    | Заявленное количество транспортных компаний, по которым будет происходить расчёт                                      |
| `request`     | array  | Содержит данные запроса на калькуляцию                                                                                |
| `results`     | array  | Содержит фактическое количество транспортных компаний, по которым был произведён расчёт, а также данные этого расчёта |
| `baikal`      | array  | Результат расчёта по транспортной компании Байкал Сервис                                                              |
| `ss`/`dd`     | array  | Результат расчёта по режиму доставки склад-склад                                                                      |
| `tariff`      | string | Наименование тарифа                                                                                                   |
| `cost`        | int    | Стоимость, руб                                                                                                        |
| `days`        | array  | Содержит информацию о сроках доставки                                                                                 |
| `from`        | int    | Минимальное количество дней                                                                                           |
| `to`          | int    | Максимальное количество дней                                                                                          |
| `begin`       | date   | Время начала калькуляции                                                                                              |
| `complete`    | date   | Время окончания калькуляции                                                                                           |
| `is_complete` | bool   | Статус завершенности транзакции `true` - расчёт завершен, `false` - расчёт продолжается                               |

***
[▲ Наверх](#api)