Backend для Калькулятора доставки грузов v 1.0
==============================================

[Главная страница](/README.md) > API

## Содержание

* **[Расчёт стоимости и сроков доставки (калькуляция)](#calculate)**
  * [Описание процесса](#calculateDescribe)
  * [Пример структуры данных запроса](#calculateRequestExample)
  * [Пример структуры данных ответа](#calculateResponseExample)
  * [Описание параметров запроса](#calculateRequestDescribe)
  * [Описание параметров ответа](#calculateResponseDescribe)
* **[Получение результата калькуляции](#calculateResult)**
  * [Описание процесса](#calculateResultDescribe)
  * [Пример структуры данных запроса](#calculateResultRequestExample)
  * [Пример структуры данных ответа](#calculateResultResponseExample)
  * [Описание параметров запроса](#calculateResultRequestDescribe)
  * [Описание параметров ответа](#calculateResultResponseDescribe)
* **[Автокомплит (в разработке)](#autocomplete)**

## <a name="calculate"/>Расчёт стоимости и сроков доставки

GET: https://example.com/api/v1/calculate

### <a name="calculateDescribe"/>Описание процесса

Метод принимает параметры для расчёта сроков и стоимости доставки, а возвращает идентификатор для получения результатов этого расчёта. Дело в том, что скорость расчётов у одной транспортной компании занимает менее 1 секунды, а у другой - более 10 секунд. Поэтому запросы выполняются независимо, а результаты их выполнения записываются в Redis. Доступ к этой записи можно получить по идентификатору, который возвращает данный метод.

### <a name="calculateRequestExample"/>Пример структуры данных запроса

> [Пример запроса](https%3A%2F%2Fexample.com%2Fapi%2Fv1%2Fcalculate%3Ffrom%3D%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE%D1%8F%D1%80%D1%81%D0%BA%2C%20%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE%D1%8F%D1%80%D1%81%D0%BA%D0%B8%D0%B9%20%D0%BA%D1%80%D0%B0%D0%B9%26to%3D%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0%2C%20%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0%26places%5B0%5D%5Bweight%5D%3D20%26places%5B0%5D%5Blength%5D%3D100%26places%5B0%5D%5Bwidth%5D%3D50%26places%5B0%5D%5Bheight%5D%3D20%26places%5B1%5D%5Bweight%5D%3D10%26places%5B1%5D%5Blength%5D%3D75%26places%5B1%5D%5Bwidth%5D%3D15%26places%5B1%5D%5Bheight%5D%3D10%26companies%5B%5D%3Dbaikal%26companies%5B%5D%3Dcdek%26companies%5B%5D%3Ddpd%26delivery_type%5B%5D%3Dss%26delivery_type%5B%5D%3Dsd%26delivery_type%5B%5D%3Dds%26delivery_type%5B%5D%3Ddd%26insurance%3D3200%26cash_on_delivery%3D6500%26shipment_date%3D2025-10-10)

```javascript
{
    "from": "Красноярск, Красноярский край",
    "to": "Москва, Москва",
    "places": [
        {
            "weight": "10",
            "length": "100",
            "width": "20",
            "height": "10",
            "volume": "0.2"
        },
        {
            "weight": "20",
            "length": "60",
            "width": "30",
            "height": "15",
            "volume": "0.027"
        }
    ],
    "companies": [
        "baikal",
        "cdek"
    ],
    "delivery_type": [
        "ss",
        "ds"
    ],
    "insurance": 3200,
    "cash_on_delivery": 6500,
    "shipment_date": "2025-09-06"
}
```

### <a name="calculateResponseExample"/>Пример структуры данных ответа

```javascript
{
    "success": true,
    "message": "",
    "data": {
        "transaction": "583be48f8cfb5c1d642a5137b96c87e3"
    }
}
```

### <a name="calculateRequestDescribe"/>Описание параметров запроса

| Имя параметра      | Тип    | Обязательный | Описание                                                                                                                       | Будет изменён                                                                               |
| ------------------ | ------ | ------------ | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------- |
| `from`             | string | Да           | Откуда, формат: Город, Регион. Например `Красноярск, Красноярский край`                                                        | После написания метода autocomplete будут внесены коррективы в формат принимаемого значения |
| `to`               | string | Да           | Куда, формат: Город, Регион. Например `Москва, Москва`                                                                         | После написания метода autocomplete будут внесены коррективы в формат принимаемого значения |
| `places`           | array  | Да           | Грузовые места. Коллекция грузовых мест.                                                                                       | -                                                                                           |
| `weight`           | float  | Да           | Вес грузового места, кг                                                                                                        | -                                                                                           |
| `length`           | int    | Да           | Длина грузового места, см                                                                                                      | -                                                                                           |
| `width`            | int    | Да           | Ширина грузового места, см                                                                                                     | -                                                                                           |
| `height`           | int    | Да           | Высота грузового места, см                                                                                                     | -                                                                                           |
| `volume`           | float  | Нет          | Объём грузового места, м3                                                                                                      | Возможно излишен                                                                            |
| `companies`        | array  | Да           | Компании, участвующие в расчёте                                                                                                | -                                                                                           |
| `delivery_type`    | array  | Нет          | Способ доставки. Проинимает следующие значения: `ss` - склад-склад, `ds` - дверь-склад, `sd` - склад-дверь, `dd` - дверь-дверь | -                                                                                           |
| `insurance`        | int    | Нет          | Объявленная ценность, руб                                                                                                      | -                                                                                           |
| `cash_on_delivery` | int    | Нет          | Наложенный платёж, руб                                                                                                         | Возможно излишен                                                                            |
| `shipment_date`    | string | Да           | Дата отправки, формат `ГГГГ-ММ-ДД`                                                                                             | -                                                                                           |

### <a name="calculateResponseDescribe"/>Описание параметров ответа

| Имя параметра | Тип    | Описание                                            |
| ------------- | ------ | --------------------------------------------------- |
| `transaction` | string | Идентификатор для получения результатов калькуляции |

## <a name="calculateResult"/>Результат калькуляции

GET: https://example.com/api/v1/calculate-result

### <a name="calculateResultDescribe"/>Описание процесса

Метод принимает идентификатор и возвращает результаты расчётов. Данные пополняются до тех пор, пока все транспортные компании, участвующие в расчёте не завершат свою работу. Количество заявленных транспортных компаний указано в параметре `count`. Фактическое количество транспортных компаний, которые завершили свою работу находится в параметре `result`. Данные снабжены флагом `is_complete`, который указывает на завершенность расчётов, он становится true, когда расчёты выполнены.

### <a name="calculateResultResponseExample"/>Пример структуры данных запроса

> [Пример запроса](https%3A%2F%2Fexample.com%2Fapi%2Fv1%2Fcalculate-result%3Fget%3Daae86da3d02b99adc004813f282fe7c8)

```javascript
{
    "get": "583be48f8cfb5c1d642a5137b96c87e3"
}
```

### <a name="calculateResultRequestExample"/>Пример структуры данных ответа

> [У этого примера есть полная версия](/documentation/examples/calculate-result.json)

```javascript
{
    "count": 2,
    "request": {
        "from": "Красноярск, Красноярский край",
        "to": "Москва, Москва",
        "places": [
            {
                "weight": "10",
                "length": "100",
                "width": "20",
                "height": "10",
                "volume": "0.2"
            },
            {
                "weight": "20",
                "length": "60",
                "width": "30",
                "height": "15",
                "volume": "0.027"
            }
        ],
        "companies": [
            "baikal",
            "cdek"
        ],
        "delivery_type": [
            "ss",
            "ds"
        ],
        "shipment_date": "2025-09-06"
    },
    "results": {
        "baikal": {
            "ss": [
                {
                    "tariff": "Автоперевозка",
                    "cost": 1454.2,
                    "days": {
                        "from": 7,
                        "to": 7
                    }
                }
            ]
        },
        "cdek": {
            "ds": [
                {
                    "tariff": "Магистральный экспресс дверь-склад",
                    "cost": 3160,
                    "days": {
                        "from": 6,
                        "to": 7
                    }
                }
            ]
        }
    },
    "begin": "2025-08-11T23:29:22.554094Z",
    "complete": "2025-08-11T23:29:56.276428Z",
    "is_complete": true
}
```

### <a name="calculateResultResponseDescribe"/>Описание параметров запроса

| Имя параметра | Тип    | Обязательный | Описание                                        |
| ------------- | ------ | ------------ | ----------------------------------------------- |
| `get`         | string | Да           | Идентификатор получения результатов калькуляции |

### <a name="calculateResultRequestDescribe"/>Описание параметров ответа

| Имя параметра | Тип    | Описание                                                                                                              |
| ------------- | ------ | --------------------------------------------------------------------------------------------------------------------- |
| `count`       | int    | Заявленное количество транспортных компаний, по которым будет происходить расчёт                                      |
| `request`     | array  | Содержит данные запроса на калькуляцию                                                                                |
| `results`     | array  | Содержит фактическое количество транспортных компаний, по которым был произведён расчёт, а также данные этого расчёта |
| `baikal`      | array  | Результат расчёта по транспортной компании Байкал Сервис                                                              |
| `ss`          | array  | Результат расчёта по режиму доставки склад-склад                                                                      |
| `tariff`      | string | Наименование тарифа                                                                                                   |
| `cost`        | int    | Стоимость, руб                                                                                                        |
| `days`        | array  | Содержит информацию о сроках доставки                                                                                 |
| `from`        | int    | Минимальное количество дней                                                                                           |
| `to`          | int    | Максимальное количество дней                                                                                          |
| `begin`       | date   | Время начала калькуляции                                                                                              |
| `complete`    | date   | Время окончания калькуляции                                                                                           |
| `is_complete` | bool   | Статус завершенности транзакции `true` - расчёт завершен, `false` - расчёт продолжается                               |

## <a name="autocomplete"/>Автокомплит

GET: https://example.com/api/v1/autocomplete

**В разработке**